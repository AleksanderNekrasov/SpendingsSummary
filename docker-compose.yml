version: '3.4'

services:
  spendingssummary.fileprocessor:
    image: spendingssummaryfileprocessor
    container_name: 'spendingssummary.fileprocessor'
    build:
      context: .
      dockerfile: SpendingSummary.FileProcessor/SpendingSummary.FileProcessor.WorkerService/Dockerfile
    volumes:
      - "imported-files:/${ImportSettings__ReportFilesFolder}"
    depends_on:
      - spendingssummary.db
      - spendingssummary.rabbitmq
    networks:
        - queue-net
  spendingssummary.dataaccess:
    image: spendingssummarydataaccess
    container_name: 'spendingssummary.dataaccess'
    build:
      context: .
      dockerfile: SpendingSummary.DataStore/SpendingSummary.DataStore.WorkerService/Dockerfile    
    depends_on:
      - spendingssummary.db
      - spendingssummary.rabbitmq
    networks:
        - queue-net
  spendingssummary.db:
    image: mcr.microsoft.com/mssql/server
    container_name: 'spendingssummary.db'
    environment:
      SA_PASSWORD: "2%t}t!ncFEkX2cUb"
      ACCEPT_EULA: "Y"
    ports:  
      - "1433:1433"
    volumes:
      - "db-data:/var/opt/mssql/" 
    networks:
        - queue-net
  spendingssummary.rabbitmq:
    image: spendingssummaryqueue
    container_name: 'spendingssummary.rabbitmq'
    build:
      context: .
      dockerfile: SpendingSummary.Rabbitmq/Dockerfile
    ports:
        - 5672:5672
        - 15672:15672
    volumes:
        - rabbit-data:/var/lib/rabbitmq/
        - rabbit-logs:/var/log/rabbitmq/
        - rabbit-conf:/etc/rabbitmq/
    networks:
        - queue-net
volumes:
  db-data:
  rabbit-data:
  rabbit-logs:
  imported-files:
  rabbit-conf:
networks:
  queue-net:
    driver: bridge